<!DOCTYPE html>
<html>
<head>
	<title>Decipher Clips</title>
	<link rel="stylesheet" href="codemirror-5.43.0/lib/codemirror.css">
  <link rel="stylesheet" href="codemirror-5.43.0/addon/hint/show-hint.css">
	<link rel="stylesheet" href="codemirror-5.43.0/addon/dialog/dialog.css">
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light" id="nav-toolbar">
  <a class="navbar-brand" href="#"></a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          File
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="#">Open</a>
          <a class="dropdown-item" href="#">Save</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Close</a>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Edit
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="#">Find</a>
          <a class="dropdown-item" href="#">Find Next</a>
          <a class="dropdown-item" href="#">Replace</a>
          <a class="dropdown-item" href="#">Replace All</a>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Preferences
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" data-toggle="modal" href="#settingsModal">Settings</a>
        </div>
      </li>
    </ul>
  </div>
</nav>

<div class="container-fluid" id="code-container">
	<textarea id="code"></textarea>
</div>

<!-- Modal -->
<div class="modal fade" id="settingsModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalCenterTitle">Settings</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <ul class="nav nav-tabs">
          <li class="nav-item">
            <a class="nav-link active" data-toggle="tab" href="#EditorSettingsTab">Editor</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#HotkeySettingsTab">Hotkey</a>
          </li>
        </ul>
        <div class="tab-content">
          <div id="EditorSettingsTab" class="tab-pane-setting tab-pane active">
            <h5>Editor Settings</h5>
            <form>
              <div class="form-group row">
                <label class="col-form-label col-md-2">Editor Theme</label>
                <div class="col-md-10">
                  <select class="form-control" id="themeSelector"></select>
                </div>
              </div>
            </form>
          </div>
          <div id="HotkeySettingsTab" class="tab-pane-setting tab-pane fade">
            <h5>Hotkey Settings</h5>
            <table class="table" id="hotkeyTable">
              <thead>
                <tr>
                  <th>Action</th>
                  <th>Key</th>
                </tr>
              </thead>
              <tbody>
                
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!------------------------ BOOTSTRAP SCRIPTS --------------------------------------------------->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!-------------------------- CODEMIRROR SCRIPTS -------------------------------------------------->
<script type="text/javascript" src="codemirror-5.43.0/lib/codemirror.js"></script>
<script type="text/javascript" src="codemirror-5.43.0/addon/hint/show-hint.js"></script>
<script type="text/javascript" src="codemirror-5.43.0/addon/hint/xml-hint.js"></script>
<script type="text/javascript" src="codemirror-5.43.0/addon/fold/xml-fold.js"></script>
<script type="text/javascript" src="codemirror-5.43.0/addon/dialog/dialog.js"></script>
<script type="text/javascript" src="codemirror-5.43.0/addon/search/search.js"></script>
<script type="text/javascript" src="codemirror-5.43.0/mode/htmlmixed/htmlmixed.js"></script>
<script type="text/javascript" src="codemirror-5.43.0/mode/javascript/javascript.js"></script>
<script type="text/javascript" src="codemirror-5.43.0/mode/css/css.js"></script>

<script type="text/javascript" src="codemirror-5.43.0/lib/codemirror.js"></script>
<script type="text/javascript" src="codemirror-5.43.0/addon/edit/closetag.js"></script>
<script type="text/javascript" src="codemirror-5.43.0/addon/edit/matchtags.js"></script>
<script type="text/javascript" src="js/decipher-clips.js"></script>
<script type="text/javascript">
$(document).ready(function(e) {

  var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
    mode: "xml",
    lineNumbers: true,
    autoCloseTags: true,
    matchClosing: true,
    theme: "solarized dark"
  });
    

  var decipherclips = new DecipherClips(editor)

  editor.setOption("extraKeys", {
  	">": function(cm) {
  		CodeMirror.commands.closeTag()
  	},
    "Ctrl-1": function() { 
        decipherclips.makeRows() 
    },
    "Ctrl-2": function() { 
        decipherclips.makeCols() 
    },
    "Ctrl-3": function() { 
        decipherclips.makeChoices() 
    },
    "Ctrl-4": function() { 
        decipherclips.makeRowsMatchValues() 
    },
    "Ctrl-5": function() { 
        decipherclips.makeColsMatchValues() 
    },
    "Ctrl-6": function() { 
        decipherclips.makeChoicesMatchValues() 
    },
    "Ctrl-7": function() { 
        decipherclips.addValues() 
    },
    "Ctrl-8": function() { 
        decipherclips.removeValues() 
    },
    "Alt-1": function() { 
        decipherclips.makeRowsMatchLabel() 
    },
    "Alt-2": function() { 
        decipherclips.makeColsMatchLabel() 
    },
    "Alt-3": function() { 
        decipherclips.makeChoicesMatchLabel() 
    },
    "Ctrl-R": function() { 
        decipherclips.makeRadio() 
    },
    "Ctrl-E": function() { 
        decipherclips.makeTextbox() 
    },
    "Ctrl-S": function() { 
        decipherclips.makeSelect() 
    },
    "Shift-Ctrl-E": function() { 
        decipherclips.makeTextArea() 
    },
    "Ctrl-Q": function() {
        decipherclips.makeNumber()  
    },
    "Shift-Ctrl-C": function() { 
        decipherclips.makeCheckbox() 
    },
    "Shift-Ctrl-G": function() {
        decipherclips.makeGroups()  
    },
    "Ctrl-B": function() { 
      var blockLabel = prompt("Enter label for block: ")
      decipherclips.makeBlock(blockLabel) 
    },
    "Ctrl-L": function() { 
        decipherclips.makeLoop() 
    },
    "Ctrl-H": function() { 
        var htmlLabel = prompt("Enter label for HTML: ")
        decipherclips.makeHTML(htmlLabel) 
    },
    "Alt-G": function() {
      var group = prompt("Enter group to assign: ")
      decipherclips.assignGroup(group)
    },
    "Alt-R": function() {
        decipherclips.removeGroup()  
    },
    "Alt-W": function() {
      var tag = prompt("Enter tag: ")
      decipherclips.wrapTag(tag)  
    }
  })

  var themespath = "codemirror-5.43.0/theme/"
  //Insert themes 
  $.get(themespath, function(data) {
  	$(data).find("a").each(function(index, element) {

      //Inject css files to <head>
  		$ ("head").append($("<link>", {
  			"rel": "stylesheet",
  			"href": themespath + $(element).attr("href")
  		}))
      //Append theme to theme selector 
      var themeName = $(element).attr("href").match(/[a-zA-Z0-9+_-]+(?=\.css)/)

      $("#themeSelector").append($("<option>", {
        "text": themeName,
        "value": themeName
      }))
  	})
  })

  $("#themeSelector").change(function(e) {
    editor.setOption("theme", e.currentTarget.value)
  })

  hotkeySettings = {
    MakeRows: {
      Name: "Make rows",
      Key: "Ctrl-1"
    },
    MakeRowsMatchLabel: {
      Name: "Make rows match label",
      Key: "Alt-1"
    },
    MakeRowsMatchValues: {
      Name: "Make rows match values",
      Key: "Ctrl-4"
    },
    MakeCols: {
      Name: "Make columns",
      Key: "Ctrl-2"
    },
    MakeColsMatchLabel: {
      Name: "Make columns match label",
      Key: "Alt-2"
    },
    MakeColsMatchValues: {
      Name: "Make columns match values",
      Key: "Ctrl-5"
    },
    MakeChoices: {
      Name: "Make choices",
      Key: "Ctrl-3"
    },
    MakeChoicesMatchLabel: {
      Name: "Make choices match label",
      Key: "Alt-3"
    },
    MakeChoicesMatchValues: {
      Name: "Make choices match values",
      Key: "Ctrl-6"
    },
    MakeGroups: {
      Name: "Make groups",
      Key: "Shift-Ctrl-G"
    },
    AssignGroup: {
      Name: "Assign group",
      Key: "Alt-A"
    },
    RemoveGroup: {
      Name: "Remove group",
      Key: "Alt-G"
    },
    AddValues: {
      Name: "Add value attribute",
      Key: "Ctrl-7"
    },
    RemoveValues: {
      Name: "Remove value attribute",
      Key: "Ctrl-8"
    },
    MakeRadio: {
      Name: "Make radio",
      Key: "Ctrl-R"
    },
    MakeCheckbox: {
      Name: "Make checkbox",
      Key: "Shift-Ctrl-C"
    },
    MakeSelect: {
      Name: "Make select",
      Key: "Ctrl-S"
    },
    MakeText: {
      Name: "Make text",
      Key: "Ctrl-E"
    },
    MakeTextArea: {
      Name: "Make textarea",
      Key: "Shift-Ctrl-E"
    },
    MakeNumber: {
      Name: "Make number",
      Key: "Ctrl-Q"
    },
    MakeBlock: {
      Name: "Make block",
      Key: "Ctrl-B"
    },
    MakeHTML: {
      Name: "Make HTML",
      Key: "Shift-Ctrl-H"
    }
  }


  for(var property in hotkeySettings) {
    
    var setting = hotkeySettings[property]
    var hotkeyTable = $("#hotkeyTable tbody")
    var hotkeyTableRow = $("<tr>", {
      "class": "key-binding-row"
    })

    for(var key in setting) {
      $(hotkeyTableRow).append($("<td>", {
        "class": setting[key],
        "data-property": setting[key],
        "text": setting[key]
      }))
    }
    hotkeyTable.append(hotkeyTableRow)
  }


})
</script>
<script type="text/javascript"></script>
</body>
</html>